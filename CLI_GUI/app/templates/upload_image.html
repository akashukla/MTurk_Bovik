<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bowser@2.5.3/es5.js"></script>
    <script src="2-bowser.js"></script> -->
    <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" media="all" rel="stylesheet" type="text/css">
    <link href="https://static.jquery.com/ui/css/demo-docs-theme/ui.theme.css" media="all" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <style>
    </style>

</head>

<body>

    <div class='container'style="text-align: center;" >
        <h1 style="text-align: center;" class="display-4">Image Compression Page</h1>
        <br>
        <input type="file" name- "file[]" class="form-control-file border" id='file' multiple>
        <br>
        <button type="button" class="btn btn-primary" id='ssubmit'>Compress Image</button>
        <br>
        <div style="display: none;">
            <button type="button" class="btn btn-primary" id="show_image">Got image, show?</button>
        </div>
        <br>
        <div id="image_class" style="display: none;">
            <h4>Compressed Image:</h1>
            
        </div>
    </div>
</body>
<script>
    $('#show_image').on('click',function(){

        });
        $('#ssubmit').on('click',function(){
            console.log('button clicked');

            var fd = new FormData();
            var files = $('#file')[0].files;
            console.log(files);
            for (var i = 0; i < files.length; i++) {
                var n = 'file'+String(i);
                fd.append(n,files[i]);
            }
            

            $.ajax({
                url : 'upload',
                type : 'post',
                data : fd,
                contentType: false,
                processData: false,
                enctype:"multipart/form-data",

                success: function( data, textStatus, jQxhr ){
                   console.log('it worked');
                   console.log(data);
                   //console.log(btoa(data));
                   var num_images = data['num_images'];
                   var image_strings = data['image_strings'];
                   console.log(encodeURI(data));
                   //console.log(btoa(encodeURI(data)));
                   $('#img').remove();
                   for(var i=0;i<num_images;i++){
                    $('#image_class').append('<img id="img" src="data:image/jpg;base64,' + encodeURI(data['image_strings'][i]) + '"/><br>');
                   }
                   

                    //$('#image_class').html('<img src="data:image/jpg;base64,' + encodeURI(data) + '"/>');
                   //document.getElementById('image_class').style.display = 'block';
                   $("#image_class").show();
                },
                error: function( jqXhr, textStatus, errorThrown ){
                    alert('oh no');
                    console.log( errorThrown );
    }
            })

        });
</script>

</html>